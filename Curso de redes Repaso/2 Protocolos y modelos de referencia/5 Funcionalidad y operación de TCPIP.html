<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TCP/IP: Explicación + Nemotecnia + Test con pistas (barajado)</title>
<style>
  :root { --ok:#16a34a; --bad:#dc2626; --muted:#6b7280; --card:#0ea5e9; --accent:#2563eb; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans'; margin: 24px; line-height: 1.45; }
  header { border: 2px solid #e5e7eb; border-left: 8px solid var(--card); padding: 16px 18px; border-radius: 14px; margin-bottom: 22px; background: #f8fafc; }
  h1 { margin: 0 0 6px 0; font-size: 1.6rem; }
  h2 { font-size: 1.2rem; margin: 18px 0 8px; }
  .pill { display:inline-block; background:#e0f2fe; color:#0369a1; padding:2px 10px; border-radius:999px; font-size:.9rem; margin-bottom:8px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; }
  .story { background:#fff; border:1px dashed #cbd5e1; padding:12px 14px; border-radius:12px; }
  .layerlist { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px; margin-top:8px; }
  .layer { background:#ffffff; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; }
  .layer b { display:block; }
  .mnemo { background:#ecfeff; border:1px solid #bae6fd; padding:10px 12px; border-radius:12px; }
  .muted { color:#6b7280; }

  /* Novato panel */
  .reader-tools { display:flex; gap:10px; align-items:center; margin: 12px 0 8px; }
  .switch { display:inline-flex; align-items:center; gap:8px; }
  .switch button { padding:8px 12px; border-radius:999px; border:1px solid #e5e7eb; background:#1f2937; color:#fff; cursor:pointer; }
  .novato { border: 1px solid #e5e7eb; border-left: 6px solid var(--accent); background:#eff6ff; color:#1e3a8a; padding: 14px; border-radius: 12px; margin: 10px 0 18px; }
  .novato h3 { margin: 0 0 8px 0; }
  .novato .cols { display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap: 12px; }
  .card { background:#ffffff; border:1px solid #dbeafe; border-radius:12px; padding:10px 12px; }
  .check { margin-top:8px; font-size:.95rem; color:#334155; }

  /* Quiz */
  .quiz-card { border:1px solid #e5e7eb; border-radius:14px; padding:0; margin:18px 0; background:#fff; overflow:hidden; }
  .toolbar { position: sticky; top: 0; z-index: 50; display:flex; gap:10px; align-items:center; justify-content:flex-start; padding:12px 16px; border-bottom:1px solid #e5e7eb; background:#f9fafb; }
  .legend { padding: 8px 16px; font-size:.95rem; color:#475569; border-bottom:1px solid #e5e7eb; }
  .qwrap { padding:16px; }
  .q { border:1px solid #e5e7eb; border-radius:12px; padding:12px; margin:14px 0 12px; background:#fff; }
  .q p { margin: 0 0 8px 0; }
  label { display:block; padding:6px 10px; border-radius:10px; border:1px solid #e5e7eb; margin:6px 0; }
  .correct { background: #dcfce7; border-color: #bbf7d0; }
  .incorrect { background: #fee2e2; border-color: #fecaca; }
  .controls { display:flex; gap:10px; flex-wrap:wrap; margin-left:auto; }
  button { padding:10px 14px; border-radius:12px; border:1px solid #e5e7eb; cursor:pointer; background:#111827; color:#fff; }
  button.secondary { background:#f3f4f6; color:#111827; }
  .score { font-weight:700; margin-left: auto; }
  .feedback { display:none; margin-top:8px; padding:10px 12px; border-left:4px solid var(--bad); background:#fff1f2; border-radius:10px; }
  .success { display:none; margin-top:8px; padding:10px 12px; border-left:4px solid var(--ok); background:#ecfdf5; border-radius:10px; }
  .hint { display:none; margin-top:8px; padding:8px 10px; border-left:4px solid var(--accent); background:#eff6ff; border-radius:10px; color:#1e3a8a; }
  .hint-btn { background:#1f2937; }
  footer { margin-top:24px; color:#475569; font-size:.95rem; }
</style>
</head>
<body>
<header>
  <div class="pill">Modelo TCP/IP — Vista práctica</div>
  <h1>5 Funcionalidad y operación de TCPIP</h1>
  <p>TCP/IP divide la comunicación en capas para que un correo o un vídeo lleguen <i>fiables y en orden</i>, incluso con fallos temporales.</p>
  <div class="layerlist">
    <div class="layer"><b>Aplicación</b> Protocolos que usan las apps (HTTP, FTP, SMTP, DNS...).</div>
    <div class="layer"><b>Transporte</b> Fiabilidad/extremo a extremo (TCP), puertos, orden, control de flujo/congestión.</div>
    <div class="layer"><b>Internet</b> Direccionamiento y enrutamiento (IP, ICMP), TTL, fragmentación.</div>
    <div class="layer"><b>Acceso a red</b> Enlace + Física (Ethernet/Wi-Fi, MAC, tramas, medio).</div>
  </div>

  <h2>Nemotecnia</h2>
  <div class="mnemo">
    <p><b>De arriba a abajo:</b> <span class="mono">Aplicaciones Transportan Internet Accesos</span></p>
    <p class="muted">(Aplicación → Transporte → Internet → Acceso a red)</p>
  </div>

  <h2>Historia breve: “del archivo a tu app”</h2>
  <div class="story">
    <p>Tu app (<b>Aplicación</b>) pide un archivo; <b>Transporte</b> (TCP) lo trocea con números de secuencia y gestiona ventana/desbordes; <b>Internet</b> (IP) pone direcciones y elige rutas; <b>Acceso</b> mete todo en tramas y lo envía por cable o Wi-Fi. En destino, TCP reordena, pide lo perdido y entrega a la app.</p>
  </div>

  <!-- Modo Novato toggle -->
  <div class="reader-tools">
    <div class="switch">
      <span>Modo Novato:</span>
      <button id="toggle-novato">Activado</button>
    </div>
    <span class="muted">Una guía en lenguaje sencillo para empezar de cero.</span>
  </div>

  <!-- Panel Novato -->
  <section id="novato-panel" class="novato">
    <h3>Explicación para principiantes</h3>
    <div class="cols">
      <div class="card">
        <b>La idea general</b>
        <ul>
          <li><b>Aplicación:</b> qué envío (correo, web, chat).</li>
          <li><b>TCP (Transporte):</b> reparte en trozos con número, reenvía lo perdido y ordena al final.</li>
          <li><b>IP (Internet):</b> direcciones y rutas entre redes.</li>
          <li><b>Acceso a red:</b> Wi‑Fi/cable que mueve los bits entre vecinos.</li>
        </ul>
        <div class="check">Resumen: <span class="mono">App → TCP → IP → Enlace/Medio</span>.</div>
      </div>
      <div class="card">
        <b>OSI vs TCP/IP (sin líos)</b>
        <ul>
          <li>OSI es el <i>mapa teórico</i> (7 capas).</li>
          <li>TCP/IP es el <i>manual práctico</i> (4 capas).</li>
          <li>Aplicación (TCP/IP) ≈ OSI 7–5; Transporte ≈ OSI 4; Internet ≈ OSI 3; Acceso ≈ OSI 2–1.</li>
        </ul>
      </div>
      <div class="card">
        <b>Mini‑glosario</b>
        <ul>
          <li><b>Paquete (IP):</b> cajita con dirección.</li>
          <li><b>Segmento (TCP):</b> trozo con número de orden.</li>
          <li><b>Puerto:</b> “ventanilla” de la app (80 web, 25 correo…).</li>
          <li><b>Ping:</b> “¿estás ahí?” (prueba ICMP).</li>
        </ul>
      </div>
      <div class="card">
        <b>Si pasa X, mira esta capa</b>
        <ul>
          <li>Wi‑Fi flojo/cortes → <b>Acceso/Física</b>.</li>
          <li>Ping ok pero web no carga → <b>Aplicación/Transporte</b>.</li>
          <li>Red local ok pero no Internet → <b>Internet (gateway)</b>.</li>
          <li>Descarga se para y sigue → <b>TCP</b> reintenta y reordena.</li>
        </ul>
      </div>
    </div>
  </section>
</header>

<section class="quiz-card">
  <div class="toolbar">
    <div class="controls">
      <button id="btn-correct">Corregir</button>
      <button id="btn-reset" class="secondary">Reiniciar y barajar</button>
    </div>
    <span class="score" id="score"></span>
  </div>
  <div class="legend">Antes de corregir, puedes pulsar <b>Pista</b> en cada pregunta. Las <b>correctas</b> se marcan en <b>verde</b> y tus selecciones incorrectas en <b>rojo</b>.</div>
  <div class="qwrap" id="quiz"></div>
</section>

<footer>
  <p class="muted">Tip: si te lías, recuerda la cadena: App ⇢ TCP ⇢ IP ⇢ Enlace/Medio.</p>
</footer>

<script>
// ====== Utilidades ======
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// Estado de Modo Novato con persistencia
const novatoBtn = document.getElementById('toggle-novato');
const novatoPanel = document.getElementById('novato-panel');
function setNovato(on) {
  novatoPanel.style.display = on ? 'block' : 'none';
  novatoBtn.textContent = on ? 'Activado' : 'Desactivado';
  localStorage.setItem('novato_on', on ? '1' : '0');
}
novatoBtn.addEventListener('click', () => setNovato(novatoPanel.style.display === 'none'));
setNovato(localStorage.getItem('novato_on') !== '0'); // por defecto activado

// ====== Banco de preguntas TCP/IP (media–alta) ======
const BANK = [
  { type:"single",
    text:"¿En qué capa se realiza la segmentación en TCP/IP (trocear datos y numerarlos con SEQ/ACK)?",
    options:[
      {t:"Transporte (TCP)", ok:true},
      {t:"Internet (IP)", ok:false},
      {t:"Aplicación", ok:false}
    ],
    hint:"Piensa en números de secuencia, ACK y ventana.",
    explain:"TCP (Transporte) segmenta, numera (SEQ), confirma (ACK) y controla el flujo y la congestión."
  },
  { type:"single",
    text:"La elección de la ruta y el uso de direcciones lógicas origen/destino pertenecen a:",
    options:[
      {t:"Internet (IP)", ok:true},
      {t:"Acceso a red (Ethernet/Wi-Fi)", ok:false},
      {t:"Transporte (TCP)", ok:false}
    ],
    hint:"Donde viven IP y los routers.",
    explain:"El enrutamiento y las direcciones IP son funciones de la capa Internet."
  },
  { type:"multi",
    text:"Marca funciones propias de TCP (no de IP):",
    options:[
      {t:"Entrega ordenada y fiable", ok:true},
      {t:"Control de flujo (ventana deslizante)", ok:true},
      {t:"Enrutamiento entre redes", ok:false},
      {t:"Direcciones IP y TTL", ok:false}
    ],
    hint:"TCP garantiza orden/fiabilidad; IP se centra en direccionar y rutear.",
    explain:"TCP maneja orden, retransmisiones, control de flujo y (junto con algoritmos) congestión; IP direcciona/rutea."
  },
  { type:"single",
    text:"Si un paquete llega con TTL=0 y se devuelve un mensaje de error, ¿qué protocolo lo notifica típicamente?",
    options:[
      {t:"ICMP (capa Internet)", ok:true},
      {t:"TCP (Transporte)", ok:false},
      {t:"DNS (Aplicación)", ok:false}
    ],
    hint:"Mensajes de control y diagnóstico en IP.",
    explain:"ICMP informa eventos como TTL excedido, inaccesible, etc., en la capa Internet."
  },
  { type:"multi",
    text:"Estás descargando un archivo grande; la descarga se detiene y reanuda. ¿Qué mecanismos de TCP lo permiten?",
    options:[
      {t:"Retransmisiones tras timeout", ok:true},
      {t:"Acuses acumulativos (ACK)", ok:true},
      {t:"Ventana deslizante (control de flujo)", ok:true},
      {t:"Fragmentación IP", ok:false}
    ],
    hint:"Piensa en cómo TCP asegura completitud y orden aunque haya pérdidas.",
    explain:"TCP reenvía segmentos perdidos, usa ACK acumulativos y regula envío con la ventana; la fragmentación es de IP."
  },
  { type:"single",
    text:"¿Qué capa encapsula los segmentos TCP en paquetes con direcciones IP origen/destino?",
    options:[
      {t:"Internet (IP)", ok:true},
      {t:"Aplicación", ok:false},
      {t:"Acceso a red", ok:false}
    ],
    hint:"Encabezado con IP origen/destino.",
    explain:"La capa Internet encapsula segmentos en paquetes IP con direcciones lógicas."
  },
  { type:"multi",
    text:"Selecciona elementos típicos del control de congestión de TCP:",
    options:[
      {t:"Slow Start", ok:true},
      {t:"Congestion Avoidance", ok:true},
      {t:"Fast Retransmit / Fast Recovery", ok:true},
      {t:"CSMA/CD", ok:false}
    ],
    hint:"Dos son fases de crecimiento; otro reacciona a pérdidas duplicadas.",
    explain:"Slow Start, Congestion Avoidance y Fast Retransmit/Recovery son algoritmos de congestión TCP; CSMA/CD es de enlace."
  },
  { type:"single",
    text:"Para que un host salga a Internet, ¿qué parámetro IP en la PC suele ser imprescindible configurar correctamente?",
    options:[
      {t:"Puerta de enlace predeterminada (default gateway)", ok:true},
      {t:"Nombre del switch", ok:false},
      {t:"Dirección MAC manual", ok:false}
    ],
    hint:"El router al que enviar tráfico fuera de la subred.",
    explain:"El default gateway es la IP del router de salida; sin ella, no hay ruteo fuera de la red local."
  },
  { type:"single",
    text:"Un ‘ping’ exitoso verifica principalmente:",
    options:[
      {t:"Conectividad IP/ICMP entre origen y destino", ok:true},
      {t:"Que TCP esté escuchando en el puerto 80", ok:false},
      {t:"Que DNS resuelva MX", ok:false}
    ],
    hint:"Ecos ICMP.",
    explain:"Ping usa ICMP Echo Request/Reply (capa Internet)."
  },
  { type:"single",
    text:"El ‘3-way handshake’ (SYN, SYN-ACK, ACK) ocurre en:",
    options:[
      {t:"Transporte (TCP)", ok:true},
      {t:"Internet (IP)", ok:false},
      {t:"Aplicación", ok:false}
    ],
    hint:"Establecimiento de conexión fiable.",
    explain:"El establecimiento de una conexión fiable es responsabilidad de TCP."
  },
  { type:"multi",
    text:"Relaciona cada capa con un ejemplo de protocolo o elemento:",
    options:[
      {t:"Aplicación → HTTP / SMTP / DNS", ok:true},
      {t:"Transporte → TCP / UDP", ok:true},
      {t:"Internet → IP / ICMP", ok:true},
      {t:"Acceso a red → Ethernet / Wi‑Fi / MAC", ok:true}
    ],
    hint:"De arriba a abajo: App, Transporte, Internet, Acceso.",
    explain:"Es la pila TCP/IP clásica de 4 capas."
  },
  { type:"single",
    text:"El MSS de TCP suele depender de:",
    options:[
      {t:"La MTU del camino menos los encabezados IP/TCP", ok:true},
      {t:"La potencia del Wi‑Fi", ok:false},
      {t:"El número de puertos abiertos", ok:false}
    ],
    hint:"Tamaño máximo de segmento sin fragmentar.",
    explain:"MSS = MTU efectiva − (encabezado IP + TCP), para evitar fragmentación."
  },
  { type:"multi",
    text:"En la subred 192.168.1.0/24, elige configuraciones IP válidas y coherentes para PC y gateway:",
    options:[
      {t:"PC: 192.168.1.2 /24 — GW: 192.168.1.1", ok:true},
      {t:"PC: 192.168.1.1 /24 — GW: 192.168.1.1", ok:false},
      {t:"PC: 192.168.1.250 /24 — GW: 192.168.2.1", ok:false},
      {t:"PC: 192.168.1.50 /24 — GW: 192.168.1.254", ok:true}
    ],
    hint:"IP única en la subred y gateway dentro de la misma red.",
    explain:"La IP del PC no debe duplicar al gateway y ambos deben estar en la misma red /24."
  },
  { type:"single",
    text:"¿Qué capa trata la fragmentación de paquetes cuando un enlace tiene MTU menor que el tamaño del paquete IP?",
    options:[
      {t:"Internet (IP)", ok:true},
      {t:"Transporte (TCP)", ok:false},
      {t:"Aplicación", ok:false}
    ],
    hint:"No confundir con ‘segmentación’.",
    explain:"La fragmentación es propia de IP (capa Internet), no de TCP."
  },
  { type:"multi",
    text:"Selecciona afirmaciones correctas sobre UDP vs TCP:",
    options:[
      {t:"UDP no garantiza entrega ni orden; es más ligero", ok:true},
      {t:"TCP garantiza orden y fiabilidad", ok:true},
      {t:"UDP siempre realiza 3-way handshake", ok:false},
      {t:"TCP carece de control de flujo", ok:false}
    ],
    hint:"Uno es sin conexión; el otro, orientado a conexión y fiable.",
    explain:"UDP es ligero y sin conexión; TCP es fiable, con control de flujo y congestión."
  },
  { type:"single",
    text:"En Packet Tracer, al hacer ping del router a la PC, ¿qué debe estar bien configurado en la PC?",
    options:[
      {t:"IP y máscara correctas en la misma subred del router", ok:true},
      {t:"Nombre del dispositivo coincidente con el del router", ok:false},
      {t:"Velocidad del puerto del switch", ok:false}
    ],
    hint:"Direcciones coherentes en la misma red.",
    explain:"Para conectividad L3 directa, IP/máscara deben pertenecer a la misma subred del router."
  },
  { type:"single",
    text:"NAT/PAT que traduce muchas IP privadas a una IP pública actúa principalmente en:",
    options:[
      {t:"Internet (en el borde, con conocimiento de puertos)", ok:true},
      {t:"Transporte", ok:false},
      {t:"Aplicación", ok:false}
    ],
    hint:"Traducción de direcciones IP (y puertos).",
    explain:"La traducción se hace en el borde (capa Internet), mapeando IP/puertos."
  },
  { type:"single",
    text:"¿Qué campo de TCP ayuda a recomponer datos en orden en destino?",
    options:[
      {t:"Números de secuencia (SEQ)", ok:true},
      {t:"Dirección MAC", ok:false},
      {t:"Código de tiempo (TTL)", ok:false}
    ],
    hint:"Cada segmento indica su posición en el flujo.",
    explain:"Los números de secuencia permiten reordenar y detectar pérdidas."
  },
  { type:"multi",
    text:"Cuando se produce pérdida de paquetes, TCP suele reaccionar con:",
    options:[
      {t:"Reducción de la ventana de congestión", ok:true},
      {t:"Retransmisión de segmentos", ok:true},
      {t:"Aumentar indefinidamente la tasa de envío", ok:false},
      {t:"Cambiar la dirección IP de origen", ok:false}
    ],
    hint:"Evitar congestión y recuperar datos.",
    explain:"TCP reduce cwnd y retransmite; no cambia IP ni incrementa sin control la tasa."
  }
];

let QUESTIONS = [];
const quiz = document.getElementById('quiz');
const btnCorrect = document.getElementById('btn-correct');
const btnReset = document.getElementById('btn-reset');
const scoreEl = document.getElementById('score');

function createQuestionEl(q, idx) {
  const wrapper = document.createElement('div');
  wrapper.className = 'q';
  wrapper.dataset.type = q.type;

  const p = document.createElement('p');
  p.innerHTML = `<b>${idx + 1}.</b> ${q.text}`;
  wrapper.appendChild(p);

  const opts = shuffle(q.options.map(o => ({...o})));
  opts.forEach(o => {
    const label = document.createElement('label');
    const input = document.createElement('input');
    input.type = 'checkbox';
    input.value = o.ok ? 'true' : 'false';
    label.appendChild(input);
    label.insertAdjacentText('beforeend', ' ' + o.t);
    wrapper.appendChild(label);
  });

  const hintBtn = document.createElement('button');
  hintBtn.type = 'button';
  hintBtn.textContent = 'Pista';
  hintBtn.className = 'hint-btn secondary';
  const hintBox = document.createElement('div');
  hintBox.className = 'hint';
  hintBox.innerHTML = q.hint;
  wrapper.appendChild(hintBtn);
  wrapper.appendChild(hintBox);

  const fb = document.createElement('div');
  fb.className = 'feedback';
  wrapper.appendChild(fb);
  const ok = document.createElement('div');
  ok.className = 'success';
  ok.textContent = '✅ ¡Correcto!';
  wrapper.appendChild(ok);

  hintBtn.addEventListener('click', () => {
    hintBox.style.display = 'block';
    hintBtn.disabled = true;
  });

  return wrapper;
}

function buildQuiz() {
  quiz.innerHTML = '';
  QUESTIONS = shuffle(BANK.map(q => ({...q, options: q.options.map(o => ({...o}))})));
  QUESTIONS.forEach((q, i) => quiz.appendChild(createQuestionEl(q, i)));
  scoreEl.textContent = '';
  window.scrollTo({ top: 0 });
}

function evaluateQuestion(node) {
  const type = node.dataset.type;
  const labels = Array.from(node.querySelectorAll('label'));
  let ok = true;
  let correctTexts = [];

  labels.forEach(label => {
    label.classList.remove('correct', 'incorrect');
    const cb = label.querySelector('input[type="checkbox"]');
    const isTrue = cb.value === 'true';
    const checked = cb.checked;
    if (isTrue) {
      label.classList.add('correct');
      correctTexts.push(label.textContent.trim());
      if (!checked) ok = false;
    } else {
      if (checked) {
        label.classList.add('incorrect');
        ok = false;
      }
    }
  });

  if (type === 'single') {
    const checkedCount = labels.filter(l => l.querySelector('input').checked).length;
    const correctChecked = labels.some(l => l.querySelector('input').checked && l.querySelector('input').value === 'true');
    if (!(checkedCount === 1 && correctChecked)) ok = false;
  }

  const fb = node.querySelector('.feedback');
  const okBox = node.querySelector('.success');
  if (ok) {
    fb.style.display = 'none';
    fb.innerHTML = '';
    okBox.style.display = 'block';
  } else {
    okBox.style.display = 'none';
    const qText = node.querySelector('p').innerText.replace(/^\d+\.\s*/, '');
    const match = QUESTIONS.find(q => q.text === qText);
    const explanation = match ? match.explain : '';
    const correctList = correctTexts.map(t => `<li>${t}</li>`).join('');
    fb.innerHTML = `<b>Respuesta correcta:</b><ul>${correctList}</ul><div>${explanation}</div>`;
    fb.style.display = 'block';
  }
  return ok;
}

function correctAll() {
  const qNodes = Array.from(document.querySelectorAll('.q'));
  let right = 0;
  qNodes.forEach(node => { if (evaluateQuestion(node)) right++; });
  scoreEl.textContent = `Puntuación: ${right} / ${qNodes.length}`;
  document.querySelector('.quiz-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function resetAll() {
  buildQuiz();
}

document.getElementById('btn-correct').addEventListener('click', correctAll);
document.getElementById('btn-reset').addEventListener('click', resetAll);

// Inicial
buildQuiz();
</script>
</body>
</html>
